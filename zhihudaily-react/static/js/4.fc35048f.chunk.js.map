{"version":3,"sources":["StorieDetails/index.tsx"],"names":["routeId","DetailsContent","memo","article","className","src","image","alt","title","image_source","dangerouslySetInnerHTML","__html","body","StorieDetails","useState","setArticle","type","setType","slideIndex","setSlideIndex","useContext","AppContext","appState","appDispatch","history","useHistory","routeParams","useParams","fetchDetailsData","useCallback","id","axios","get","then","res","status","data","CONTENTS","catch","e","console","log","payload","comments","DES","popularity","detailsId","moveSlide","index","detailsSlideIds","length","settings","useMemo","dots","infinite","autoplay","arrows","initialSlide","beforeChange","oldIndex","newIndex","indexOf","replace","useEffect","parseInt"],"mappings":"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","file":"static/js/4.fc35048f.chunk.js","sourcesContent":["import React, {\r\n  memo,\r\n  useMemo,\r\n  useState,\r\n  useEffect,\r\n  useContext,\r\n  useCallback\r\n} from 'react';\r\nimport { useHistory, useParams } from 'react-router-dom';\r\nimport axios, { AxiosError } from 'axios';\r\nimport Slider from 'react-slick';\r\n\r\nimport { AppContext } from './../context';\r\nimport Loading from './../Loading/index';\r\nimport './index.scss';\r\n\r\ninterface Article {\r\n  image: string;\r\n  title: string;\r\n  body: string;\r\n  image_source: string;\r\n}\r\n\r\nconst DetailsContent: React.SFC<{\r\n  article: Article;\r\n}> = memo(({ article }) => {\r\n  return (\r\n    <>\r\n      <div className=\"header pre\">\r\n        <img className=\"wh100 cover2 nobd\" src={article.image} alt=\"\" />\r\n        <h4 className=\"title pab nol\">{article.title}</h4>\r\n        <span className=\"img-source pab nob nor\">{article.image_source}</span>\r\n      </div>\r\n      <div dangerouslySetInnerHTML={{ __html: article.body }}></div>\r\n    </>\r\n  );\r\n});\r\n\r\nlet routeId: number;\r\n\r\nconst StorieDetails: React.FC = memo(() => {\r\n  const [article, setArticle] = useState<Article>({} as Article);\r\n  const [type, setType] = useState<'left' | 'center' | 'right'>('center');\r\n  const [slideIndex, setSlideIndex] = useState(1);\r\n  const { appState, appDispatch } = useContext(AppContext);\r\n\r\n  const history = useHistory();\r\n  const routeParams = useParams<{\r\n    type: string;\r\n    id: string;\r\n  }>();\r\n\r\n  const fetchDetailsData = useCallback((id: number) => {\r\n    axios\r\n      .get('https://zhihu-daily.leanapp.cn/api/v1/contents/' + id)\r\n      .then(res => {\r\n        if (res.status === 200) {\r\n          setArticle(res.data.CONTENTS);\r\n        }\r\n      })\r\n      .catch((e: AxiosError) => {\r\n        console.log(e);\r\n      });\r\n    axios\r\n      .get('https://zhihu-daily.leanapp.cn/api/v1/contents/extra/' + id)\r\n      .then(res => {\r\n        if (res.status === 200) {\r\n          appDispatch({\r\n            type: 'SET_SIDEBAR_INFO',\r\n            payload: {\r\n              type: 'details',\r\n              data: {\r\n                comments: res.data.DES.comments,\r\n                popularity: res.data.DES.popularity,\r\n                detailsId: id\r\n              }\r\n            }\r\n          });\r\n        }\r\n      })\r\n      .catch((e: AxiosError) => {\r\n        console.log(e);\r\n      });\r\n  }, []);\r\n\r\n  const moveSlide = useCallback((index: number) => {\r\n    if (index === 0) {\r\n      setType('left');\r\n      setSlideIndex(0);\r\n    } else if (index === appState.detailsSlideIds.length - 1) {\r\n      setType('right');\r\n      setSlideIndex(2);\r\n    } else {\r\n      setType('center');\r\n      setSlideIndex(1);\r\n    }\r\n  }, []);\r\n\r\n  const settings = useMemo(() => {\r\n    return {\r\n      dots: false,\r\n      infinite: false,\r\n      autoplay: false,\r\n      arrows: false,\r\n      initialSlide: slideIndex,\r\n      beforeChange: function(oldIndex: number, newIndex: number) {\r\n        if (oldIndex !== newIndex) {\r\n          let index = appState.detailsSlideIds.indexOf(routeId);\r\n          index = index - oldIndex + newIndex;\r\n          routeId = appState.detailsSlideIds[index];\r\n          fetchDetailsData(routeId);\r\n          history.replace('/article/list/' + routeId);\r\n          moveSlide(index);\r\n        }\r\n      }\r\n    };\r\n  }, [slideIndex]);\r\n\r\n  useEffect(() => {\r\n    appDispatch({\r\n      type: 'SET_SIDEBAR_INFO',\r\n      payload: {\r\n        type: 'details',\r\n        data: {\r\n          comments: '...',\r\n          popularity: '...',\r\n          detailsId: routeParams.id\r\n        }\r\n      }\r\n    });\r\n    routeId = parseInt(routeParams.id);\r\n    fetchDetailsData(routeId);\r\n\r\n    // slide定位\r\n    let index = appState.detailsSlideIds.indexOf(routeId);\r\n    moveSlide(index);\r\n  }, []);\r\n\r\n  // 如果页面刷新\r\n  if (!appState.detailsSlideIds.length) {\r\n    return (\r\n      <div className=\"storie-details fe\">\r\n        <DetailsContent article={article}></DetailsContent>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // 由于slide和list有一些文章重复，所以不对slide文章做滑动翻页处理\r\n  return routeParams.type === 'list' ? (\r\n    <>\r\n      {type === 'left' && (\r\n        <Slider {...settings} className=\"details-page-slider\">\r\n          <div className=\"storie-details\">\r\n            <DetailsContent article={article}></DetailsContent>\r\n          </div>\r\n          <div className=\"storie-details\">\r\n            <Loading></Loading>\r\n          </div>\r\n          <div className=\"storie-details\">\r\n            <Loading></Loading>\r\n          </div>\r\n        </Slider>\r\n      )}\r\n      {type === 'center' && (\r\n        <Slider {...settings} className=\"details-page-slider\">\r\n          <div className=\"storie-details\">\r\n            <Loading></Loading>\r\n          </div>\r\n          <div className=\"storie-details\">\r\n            <DetailsContent article={article}></DetailsContent>\r\n          </div>\r\n          <div className=\"storie-details\">\r\n            <Loading></Loading>\r\n          </div>\r\n        </Slider>\r\n      )}\r\n      {type === 'right' && (\r\n        <Slider {...settings} className=\"details-page-slider\">\r\n          <div className=\"storie-details\">\r\n            <Loading></Loading>\r\n          </div>\r\n          <div className=\"storie-details\">\r\n            <Loading></Loading>\r\n          </div>\r\n          <div className=\"storie-details\">\r\n            <DetailsContent article={article}></DetailsContent>\r\n          </div>\r\n        </Slider>\r\n      )}\r\n    </>\r\n  ) : (\r\n    <div className=\"storie-details fe\">\r\n      <DetailsContent article={article}></DetailsContent>\r\n    </div>\r\n  );\r\n});\r\n\r\nexport default StorieDetails;\r\n"],"sourceRoot":""}